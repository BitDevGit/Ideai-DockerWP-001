# Flexible Multi-Site Nginx Configuration
# Supports: Normal sites, Subdomain multisite, Subdirectory multisite
# Routes site1.localwp, site2.localwp and all their subdomains
# Dashboard at localhost

# Upstream for Site 1
upstream wordpress1 {
    server wordpress1:9000;
}

# Upstream for Site 2
upstream wordpress2 {
    server wordpress2:9000;
}

# Upstream for Site 3
upstream wordpress3 {
    server wordpress3:9000;
}

# Optional HTTPS server blocks generated locally (glob is OK if directory is empty)
include /etc/nginx/conf.d/https/*.conf;

# ------------------------------------------------------------
# HTTP (80) â€” redirect-only (HTTPS-only dev env)
# ------------------------------------------------------------

# Dashboard redirect
server {
    listen 80 default_server;
    server_name localhost;
    return 301 https://$host$request_uri;
}

# Site 1 redirect
server {
    listen 80;
    server_name site1.localwp;
    return 301 https://$host$request_uri;
}

# Site 2 redirect
server {
    listen 80;
    server_name site2.localwp *.site2.localwp;
    return 301 https://$host$request_uri;
}

# Site 3 redirect
server {
    listen 80;
    server_name site3.localwp;
    return 301 https://$host$request_uri;
}

