<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPress Development Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .sites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .site-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .site-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .site-card.single {
            border-top: 4px solid #4CAF50;
        }

        .site-card.multi {
            border-top: 4px solid #2196F3;
        }

        .site-card.flexible {
            border-top: 4px solid #FF9800;
        }

        .site-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .site-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .site-type {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .site-links {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-block;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .status {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 1rem;
        }

        .status.active {
            background: #4CAF50;
            color: white;
        }

        .status.inactive {
            background: #f44336;
            color: white;
        }

        .info-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .info-section h2 {
            margin-bottom: 1rem;
            color: #333;
        }

        .info-section p {
            color: #666;
            line-height: 1.6;
        }

        /* Subdomain helper */
        .helper-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .helper-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        .input {
            width: 100%;
            padding: 0.75rem 0.9rem;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 0.95rem;
            outline: none;
        }

        .input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.15);
        }

        .codebox {
            background: #0b1020;
            color: #e8ecff;
            border-radius: 12px;
            padding: 1rem;
            overflow: auto;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.85rem;
            line-height: 1.45;
        }

        .helper-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 0.45rem 0.9rem;
            border-radius: 10px;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            .sites-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ WordPress Development Dashboard</h1>
            <p class="subtitle">Local Development Environment (HTTPS-only)</p>
        </header>

        <script>
            // HTTPS-only: HTTP is redirected to HTTPS by nginx.
            const PROTO = 'https:';
            const url = (host, path = '') => `${PROTO}//${host}${path}`;
            const REQUIRED_HOSTS = ['site1.localwp', 'site2.localwp', 'site3.localwp'];
        </script>

        <div class="sites-grid">
            <!-- Shared wp-content -->
            <div class="site-card multi" onclick="event.stopPropagation();">
                <div class="site-icon">üìÅ</div>
                <div class="site-title">Shared wp-content</div>
                <div class="site-type">All sites share the same themes & plugins</div>
                <div class="site-links">
                    <a href="javascript:void(0)" class="btn btn-primary" onclick="event.stopPropagation(); window.open(url('localhost','/shared-content/'), '_blank');">Browse</a>
                    <a href="javascript:void(0)" class="btn btn-secondary" onclick="event.stopPropagation(); copyOrPrompt('open ./wp-content'); toast('Run in repo terminal: open ./wp-content');">Open in Finder</a>
                </div>
            </div>

            <!-- Site 1 -->
            <div class="site-card flexible" onclick="window.open(url('site1.localwp'), '_blank')">
                <div class="site-icon">üåê</div>
                <div class="site-title">Site 1</div>
                <div class="site-type">Single site (example)</div>
                <div class="site-links">
                    <a href="javascript:void(0)" target="_blank" class="btn btn-primary" onclick="event.stopPropagation(); window.open(url('site1.localwp'), '_blank')">Frontend</a>
                    <a href="javascript:void(0)" target="_blank" class="btn btn-secondary" onclick="event.stopPropagation(); window.open(url('site1.localwp','/wp-admin'), '_blank')">Admin</a>
                    <a href="javascript:void(0)" class="btn btn-secondary" onclick="event.stopPropagation(); copyDbCmd('db1','wordpress1');">DB</a>
                </div>
                <span class="status active" id="status-site1">Checking‚Ä¶</span>
            </div>

            <!-- Site 2 -->
            <div class="site-card flexible" onclick="window.open(url('site2.localwp'), '_blank')">
                <div class="site-icon">üåê</div>
                <div class="site-title">Site 2</div>
                <div class="site-type">Multisite (subdomains) example</div>
                <div class="site-links">
                    <a href="javascript:void(0)" target="_blank" class="btn btn-primary" onclick="event.stopPropagation(); window.open(url('site2.localwp'), '_blank')">Frontend</a>
                    <a href="javascript:void(0)" target="_blank" class="btn btn-secondary" onclick="event.stopPropagation(); window.open(url('site2.localwp','/wp-admin'), '_blank')">Admin</a>
                    <a href="javascript:void(0)" class="btn btn-secondary" onclick="event.stopPropagation(); copyDbCmd('db2','wordpress2');">DB</a>
                </div>
                <span class="status active" id="status-site2">Checking‚Ä¶</span>
            </div>

            <!-- Site 3 -->
            <div class="site-card flexible" onclick="window.open(url('site3.localwp'), '_blank')">
                <div class="site-icon">üåê</div>
                <div class="site-title">Site 3</div>
                <div class="site-type">Multisite (subdirectories) example</div>
                <div class="site-links">
                    <a href="javascript:void(0)" target="_blank" class="btn btn-primary" onclick="event.stopPropagation(); window.open(url('site3.localwp'), '_blank')">Frontend</a>
                    <a href="javascript:void(0)" target="_blank" class="btn btn-secondary" onclick="event.stopPropagation(); window.open(url('site3.localwp','/wp-admin'), '_blank')">Admin</a>
                    <a href="javascript:void(0)" class="btn btn-secondary" onclick="event.stopPropagation(); copyDbCmd('db3','wordpress3');">DB</a>
                </div>
                <span class="status active" id="status-site3">Checking‚Ä¶</span>
            </div>
        </div>

        <div class="info-section">
            <h2>‚úÖ Quick Fix: missing DNS/hosts</h2>
            <p>
                If a site shows <strong>DNS not configured</strong>, add these to <code>/etc/hosts</code> (macOS requires sudo):
            </p>
            <pre id="baseHostsLines" class="codebox"># This script updates a clearly-marked block in /etc/hosts (safe to re-run)
curl -fsSL https://localhost/hosts-sync.sh | sudo bash</pre>
            <pre id="baseSudoCmd" class="codebox">curl -fsSL https://localhost/hosts-sync.sh | sudo bash</pre>
            <div class="helper-actions" style="margin-top:0.75rem;">
                <button class="btn btn-primary btn-small" id="copyBaseHosts">Copy command</button>
                <button class="btn btn-secondary btn-small" id="copyBaseSudo">Copy command</button>
            </div>
        </div>

        <div class="info-section">
            <h2>üß© Subdomain Multisite Helper (outside WordPress)</h2>
            <p>
                For multisite subdomains (e.g. <code>sub1.site2.localwp</code>), your Mac must resolve each subdomain.
                <strong>/etc/hosts has no wildcards</strong>, so you add each one you plan to use.
            </p>

            <div class="helper-grid">
                <div class="helper-row">
                    <label for="subs" style="color:#333; font-weight:600;">Subdomains for <code>site2.localwp</code> (comma/space separated)</label>
                    <input id="subs" class="input" placeholder="e.g. sub1, sub2, client-a, demo" />
                </div>

                <div class="helper-row">
                    <div style="color:#333; font-weight:600;">Generated <code>/etc/hosts</code> lines</div>
                    <pre id="hostsLines" class="codebox">curl -fsSL https://localhost/hosts-sync.sh | sudo bash -s -- sub1 sub2</pre>
                </div>

                <div class="helper-row">
                    <div style="color:#333; font-weight:600;">Copy/paste command (prompts for sudo)</div>
                    <pre id="sudoCmd" class="codebox">curl -fsSL https://localhost/hosts-sync.sh | sudo bash -s -- sub1 sub2</pre>
                    <div class="helper-actions">
                        <button class="btn btn-primary btn-small" id="copyHosts">Copy hosts lines</button>
                        <button class="btn btn-secondary btn-small" id="copySudo">Copy sudo command</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check site availability
        async function probeHost(host) {
            // We only care that DNS+TLS+HTTP worked (status/redirects don't matter for this).
            const controller = new AbortController();
            const t = setTimeout(() => controller.abort(), 3500);
            try {
                await fetch(`${PROTO}//${host}/`, {
                    mode: 'no-cors',
                    cache: 'no-store',
                    signal: controller.signal
                });
                return { ok: true };
            } catch (e) {
                return { ok: false, reason: e?.name === 'AbortError' ? 'timeout' : 'network' };
            } finally {
                clearTimeout(t);
            }
        }

        function setStatus(id, ok, text) {
            const el = document.getElementById(id);
            if (!el) return;
            el.textContent = text;
            el.className = `status ${ok ? 'active' : 'inactive'}`;
        }

        async function checkSite(host, statusId) {
            setStatus(statusId, true, 'Checking‚Ä¶');
            const r = await probeHost(host);
            if (r.ok) {
                setStatus(statusId, true, 'Reachable');
            } else {
                setStatus(
                    statusId,
                    false,
                    r.reason === 'timeout'
                        ? 'Not reachable (timeout)'
                        : 'Not reachable (DNS/hosts? or site down)'
                );
            }
        }

        // Kick off checks
        checkSite('site1.localwp', 'status-site1');
        checkSite('site2.localwp', 'status-site2');
        checkSite('site3.localwp', 'status-site3');

        // --- Subdomain helper (for site2.localwp subdomain multisite) ---
        const base = 'site2.localwp';
        const subsInput = document.getElementById('subs');
        const hostsLinesEl = document.getElementById('hostsLines');
        const sudoCmdEl = document.getElementById('sudoCmd');
        const copyHostsBtn = document.getElementById('copyHosts');
        const copySudoBtn = document.getElementById('copySudo');

        function uniq(arr) {
            return [...new Set(arr.filter(Boolean))];
        }

        function parseSubs(raw) {
            return uniq(
                raw
                    .split(/[\s,]+/g)
                    .map(s => s.trim())
                    .filter(Boolean)
                    .map(s => s.replace(/[^a-zA-Z0-9-]/g, ''))
                    .filter(Boolean)
            );
        }

        function buildCmd(subs) {
            const args = subs.length ? ` -s -- ${subs.join(' ')}` : '';
            return `curl -fsSL https://localhost/hosts-sync.sh | sudo bash${args}`;
        }

        function refreshHelper() {
            if (!subsInput) return;
            const subs = parseSubs(subsInput.value || '');
            const cmd = buildCmd(subs);
            hostsLinesEl.textContent = cmd;
            sudoCmdEl.textContent = cmd;
        }

        async function copyText(text) {
            await navigator.clipboard.writeText(text);
        }

        async function copyOrPrompt(text) {
            try {
                await copyText(text);
                return true;
            } catch (e) {
                // Some browsers/contexts block clipboard writes. Prompt is a reliable fallback.
                window.prompt('Copy this command and run it in your repo terminal:', text);
                return false;
            }
        }

        function toast(message) {
            // Minimal feedback without UI bloat
            const prev = document.title;
            document.title = message;
            setTimeout(() => (document.title = prev), 900);
        }

        function copyDbCmd(dbService, dbName) {
            // Interactive: prompts for password if needed; defaults exist in compose.
            const cmd = `docker compose -f docker-compose.flexible.yml exec ${dbService} mariadb -u${dbName} -p ${dbName}`;
            copyOrPrompt(cmd);
            toast(`DB command ready for ${dbName}`);
        }

        // Base hosts copy buttons
        const copyBaseHostsBtn = document.getElementById('copyBaseHosts');
        const copyBaseSudoBtn = document.getElementById('copyBaseSudo');
        const baseHostsLinesEl = document.getElementById('baseHostsLines');
        const baseSudoCmdEl = document.getElementById('baseSudoCmd');

        if (copyBaseHostsBtn && copyBaseSudoBtn) {
            copyBaseHostsBtn.addEventListener('click', async () => {
                await copyText(baseHostsLinesEl.textContent.trim());
                copyBaseHostsBtn.textContent = 'Copied';
                setTimeout(() => (copyBaseHostsBtn.textContent = 'Copy command'), 900);
            });
            copyBaseSudoBtn.addEventListener('click', async () => {
                await copyText(baseSudoCmdEl.textContent.trim());
                copyBaseSudoBtn.textContent = 'Copied';
                setTimeout(() => (copyBaseSudoBtn.textContent = 'Copy command'), 900);
            });
        }

        if (subsInput) {
            subsInput.addEventListener('input', refreshHelper);
            copyHostsBtn.addEventListener('click', async () => {
                await copyText(hostsLinesEl.textContent);
                copyHostsBtn.textContent = 'Copied';
                setTimeout(() => (copyHostsBtn.textContent = 'Copy hosts lines'), 900);
            });
            copySudoBtn.addEventListener('click', async () => {
                await copyText(sudoCmdEl.textContent);
                copySudoBtn.textContent = 'Copied';
                setTimeout(() => (copySudoBtn.textContent = 'Copy sudo command'), 900);
            });
            refreshHelper();
        }
    </script>
</body>
</html>


